@{
    Layout = "~/Views/UILayout/Index.cshtml";
}

<div class="cardhome dark">
    <div class="homeicons">
        <a href="#" class="icon-link"><i class="ri-home-line"></i> Home</a>
        <a href="#" class="icon-link"><i class="ri-user-line"></i> User</a>
        <a href="#" class="icon-link"><i class="ri-notification-line"></i> Notifications</a>
        <a href="#" class="icon-link"><i class="ri-menu-line"></i> Menu</a>
    </div>

    <div class="search-bar">
        <input type="text" id="user-search" placeholder="Search...">
        <button><i class="ri-search-line"></i></button>
    </div>
    <div class="questionshome">
        <div id="autocomplete-results" class="search-container"></div>

        </div>
</div>

@section Scripts {
    <script>


        document.addEventListener('DOMContentLoaded', function () {
            const userSearchInput = document.getElementById('user-search');
            const autocompleteResults = document.getElementById('autocomplete-results');

            userSearchInput.addEventListener('input', function () {
                const query = userSearchInput.value;

                if (query.length < 2) {
                    autocompleteResults.innerHTML = '';
                    return;
                }

                fetch('https://localhost:7048/api/AppUser')
                    .then(response => response.json())
                    .then(data => {
                        const filteredUsers = data.Data.filter(user =>
                            user.FirstName.toLowerCase().includes(query.toLowerCase()) ||
                            user.SurName.toLowerCase().includes(query.toLowerCase())
                        );

                        autocompleteResults.innerHTML = filteredUsers.map(user =>
                            `<div class="usersearch" data-id="${user.Id}">
                                <div class="userhome-info">
                                    <img src="/Linkhtml/assets/user.jpg" alt="${user.FirstName} ${user.SurName}" class="userhome-photo">
                                    <div class="userhome-infotext">
                                        <p class="usernamehome">${user.FirstName} ${user.SurName}</p>
                                        <p class="userName">#${user.UserName}</p>
                                    </div>
                                </div>
                            </div>`
                        ).join('');

                        document.querySelectorAll('.usersearch').forEach(item => {
                            item.addEventListener('click', function () {
                                const userId = this.getAttribute('data-id');
                                window.location.href = `https://localhost:7132/profile/${userId}`;
                            });
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching user data:', error);
                    });
            });

            document.addEventListener('click', function (event) {
                if (!autocompleteResults.contains(event.target) && event.target !== userSearchInput) {
                    autocompleteResults.innerHTML = '';
                }
            });
        });



    </script>
}